好的，这是为您重新整理的完整 PRD 文档，采用 Markdown 格式。

-----

# **PRD: “Dropit” Serverless 网页剪贴板**

## **1. 项目概述**

### **1.1 项目背景**

在日常开发和测试工作中，工程师需要在多个设备间快速传递文本和图片。传统工具如即时通讯软件或邮箱在受限的“白板”设备上存在安装和登录不便的痛点。本项目旨在解决此问题，提供一个纯网页、免安装、免登录的临时数据交换方案。

“Dropit” 将是一个通过公共 URL 访问的网页应用，利用 Serverless 架构实现零服务器运维成本和高可用性。

### **1.2 项目目标**

  - **核心目标:** 创建一个公开可访问的网页应用，实现文本和图片的快速、单向同步。一台设备“粘贴”更新内容，所有访问者能立即看到新内容并一键复制。
  - **易用性目标:** 提供极致简洁的单页面用户界面，操作直观。
  - **部署目标:** 能够直接从 GitHub 仓库一键部署到 Vercel 平台，实现持续集成与持续部署 (CI/CD)。
  - **安全性目标:** 通过单一共享密码保护访问，数据存储在云端，但访问受控。

### **1.3 目标用户**

  - 软件开发者、测试工程师、运维人员。
  - 需要在多设备间，特别是受限设备上，快速传递临时信息的用户。
  - 希望拥有低成本或零成本、免维护的个人在线剪贴板的用户。

## **2. 业务需求 (User Stories)**

| 需求ID             | 角色    | 需求描述                                                               | 优先级 |
| ------------------ | ------- | ---------------------------------------------------------------------- | ------ |
| US-001             | 访客    | 我希望能通过一个预设的密码来访问剪贴板，以防止未授权的访问。             | **高** |
| US-002             | 用户    | 我希望能够在我的一台设备上（电脑A）将剪贴板中的截图直接粘贴到网页中。     | **高** |
| US-003             | 用户    | 我希望当电脑A粘贴图片后，在我的另一台设备（电脑B或手机）上能近乎实时地看到这张图片。 | **高** |
| US-004             | 用户    | 我希望能够在我的一台设备上（电脑A）将一段文本粘贴到网页中。               | **高** |
| US-005             | 用户    | 我希望当电脑A粘贴文本后，在我的另一台设备（电脑B或手机）上能近乎实时地看到这段文本。 | **高** |
| US-006             | 用户    | 我希望在网页上看到图片后，能通过点击一个按钮就将该图片复制到我的剪贴板。   | **高** |
| US-007             | 用户    | 我希望在网页上看到文本后，能通过点击一个按钮就将全部文本复制到我的剪贴板。   | **高** |
| **US-008 (已修改)** | 开发者 | 我希望这个应用能存放在 GitHub 仓库，并能自动部署到 Vercel。               | **高** |
| **US-009 (已修改)** | 开发者 | 我希望能在 Vercel 的项目设置中，通过环境变量来设置访问密码。             | **高** |

## **3. 功能设计 (Functional Design)**

### **3.1 功能流程图**

```mermaid
graph TD
    A[用户打开 Vercel URL] --> B{前端检查 Session Storage 中有无 Token};
    B -- 无 Token --> C[显示密码输入页];
    C -- 提交密码 --> D[调用后端 API 进行验证];
    D -- 验证成功 --> E[获取 Token, 存入 Session Storage, 进入主页];
    D -- 验证失败 --> F[提示错误];
    B -- 有 Token --> E;

    subgraph 主剪贴板页面
        E --> G[调用 API 获取当前内容];
        G --> H{判断内容是文本还是图片};
        H -- 文本 --> I[显示文本内容];
        H -- 图片 --> J[显示图片];

        I -- 用户粘贴/更新内容 --> K[调用 API 上传新内容];
        J -- 用户粘贴/更新内容 --> K;

        K -- 上传成功 --> L[触发页面重新获取最新内容];

        M[页面设置定时器] --> N[每隔几秒自动调用 API 获取当前内容] --> H;

        I --> O[提供"一键复制文本"按钮];
        J --> P[提供"一键复制图片"按钮];
    end
```

### **3.2 页面设计**

  - **密码验证页:**

      - **UI元素:**
          - 页面中央一个标题。
          - 一个密码输入框。
          - 一个“进入”按钮。
      - **逻辑:** 用户提交密码，前端调用后端 API 验证。成功后获取 `token` 存入 `sessionStorage` 并进入主页。

  - **主剪贴板页:**

      - **UI元素:**
          - 一个核心内容展示区（根据内容显示为文本框或图片）。
          - 一个动态的“一键复制”按钮。
          - 一个“清除内容”按钮。
      - **逻辑:**
          - **数据同步:** 页面通过**短轮询**机制（例如每 2-3 秒）自动向后端 API 请求最新数据，并根据返回结果刷新界面。
          - **内容更新:** 用户粘贴图片或文本后，前端调用对应的 API 将新内容上传至后端。
          - **一键复制:** 根据当前内容类型（文本或图片），调用浏览器剪贴板 API (`navigator.clipboard`) 将内容复制到用户剪贴板。

## **4. 技术实现 (Technical Implementation)**

### **4.1 技术栈选型**

| 层面 | 技术/框架 | 为什么选择它？ (Why this, not others?) |
| :--- | :--- | :--- |
| **整体框架** | **Next.js (部署在 Vercel 上)** | - **无缝集成:** Vercel 与 Next.js 完美结合，提供最佳开发和零配置部署体验。\<br\>- **前后端一体:** 在同一项目中编写前端页面和后端 API Routes，结构清晰。\<br\>- **Serverless 友好:** API Routes 自动部署为 Serverless Functions，成本极低。 |
| **前端** | **React (Next.js 自带)** + **SWR** | - **UI 构建:** React 是构建交互式用户界面的行业标准。\<br\>- **数据获取:** `SWR`（由 Vercel 开发）是实现数据轮询和状态管理的绝佳工具，能以极简的代码实现“近乎实时”的同步需求。 |
| **后端 API** | **Next.js API Routes (Node.js 运行时)** | - **简单快速:** 在 `/pages/api/` 目录下创建文件即可生成 API 端点，无需复杂路由设置。\<br\>- **环境统一:** 前后端均使用 JavaScript/TypeScript。 |
| **数据存储** | **Vercel KV** (存储文本) + **Vercel Blob** (存储图片) | - **Serverless 原生:** Vercel 官方存储方案，与项目集成简单。\<br\>- **替代文件系统:** Serverless 函数无状态，不能依赖本地文件系统。KV (Redis) 适合存储键值对，Blob 适合存储图片等二进制文件。\<br\>- **免费额度:** Hobby Plan 包含的免费用量足以支撑个人项目零成本运行。 |
| **部署** | **Vercel + GitHub** | - **GitOps 流程:** `git push` 到主分支即可自动触发新版本的构建和部署。\<br\>- **环境变量:** Vercel 控制台提供图形界面来管理密码、密钥等环境变量，安全且与代码分离。|

### **4.2 核心实现逻辑**

1.  **项目结构 (Next.js):**

    ```
    quick-drop/
    ├── pages/
    │   ├── api/
    │   │   ├── auth.js         # 密码验证 API
    │   │   ├── content.js      # 获取和更新内容的 API
    │   │   └── upload.js       # 处理图片上传的 API
    │   └── index.js            # 主页面组件
    ├── public/                 # 静态资源
    └── package.json
    ```

2.  **API 端点设计 (`/pages/api/`):**

      - `POST /api/auth`: 验证密码，成功则返回 `token`。
      - `GET /api/content`: 从 **Vercel KV** 读取并返回最新的内容记录。
      - `POST /api/content`: 将文本数据写入 **Vercel KV**。
      - `POST /api/upload`: 将图片上传到 **Vercel Blob**，然后将图片的 URL 路径信息写入 **Vercel KV**。

3.  **前端逻辑 (`/pages/index.js`):**

      - 使用 `useState` 管理页面状态。
      - **使用 `SWR` 进行数据轮询：**
        ```javascript
        import useSWR from 'swr';

        const fetcher = url => fetch(url).then(res => res.json());

        function MyClipboard() {
          const { data, error } = useSWR('/api/content', fetcher, {
            refreshInterval: 2000 // 每 2 秒自动重新请求
          });

          // ... 根据 data 渲染 UI
        }
        ```
      - **图片粘贴和上传：** 监听 `paste` 事件，获取图片文件后，使用 `fetch` 将其 `POST`到 `/api/upload`。

### **4.3 部署流程**

1.  **创建 GitHub 仓库:** 将项目代码推送到一个新的 GitHub 仓库。
2.  **登录 Vercel:** 使用 GitHub 账户登录 Vercel。
3.  **导入项目:** 在 Vercel Dashboard 中，导入您的 GitHub 仓库。
4.  **配置项目:**
      - Vercel 会自动识别为 Next.js 项目。
      - 进入项目的 "Settings" -\> "Environment Variables"。
      - 添加名为 `APP_PASSWORD` 的环境变量，并设置您的访问密码。
      - 根据指引关联 Vercel KV 和 Vercel Blob 存储，Vercel 会自动注入所需的连接环境变量。
5.  **部署:** 点击 "Deploy"。首次部署后，任何对主分支的 `git push` 都会自动触发新的部署。

## **5. 未来展望 (Future Scope)**

  - **多房间/频道功能:** 支持通过 URL 路径（如 `domain.com/room/abc`）创建隔离的剪贴板空间。
  - **内容有效期:** 增加内容在 N 小时后自动清除的功能。
  - **历史记录:** 提供一个简单的历史记录列表，可以查看和恢复最近几次的粘贴内容。
  - **二维码支持:** 自动为当前页面的 URL 生成二维码，方便手机扫描快速打开。